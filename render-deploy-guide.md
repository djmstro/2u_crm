# Инструкции по деплою на Render

## Подготовка проекта

1. Убедитесь, что в корне проекта есть файл `.env` со следующими переменными:
   ```
   MONGODB_URI=mongodb+srv://username:password@yourcluster.mongodb.net/?retryWrites=true&w=majority
   MONGODB_DB=2u_studio_kb
   NEXT_PUBLIC_API_URL=https://your-render-app-url.onrender.com
   ```

2. Проверьте наличие файлов для сборки проекта:
   - `package.json` с корректными скриптами build и start
   - `next.config.js` с настройками Next.js
   - `pre-deploy.sh` для инициализации базы данных (опционально)

## Настройка на Render

1. Создайте новый Web Service на Render:
   - Подключите ваш GitHub репозиторий
   - Выберите ветку для деплоя (обычно main или master)

2. Настройте основные параметры:
   - **Name**: `2u-studio-kb` (или любое другое имя)
   - **Environment**: Node
   - **Build Command**: `npm install && npm run build`
   - **Start Command**: `npm run start`

3. Настройте переменные окружения:
   - `MONGODB_URI`: строка подключения к вашей MongoDB (скопируйте из вашего .env файла)
   - `MONGODB_DB`: имя базы данных (обычно 2u_studio_kb)
   - `NEXT_PUBLIC_API_URL`: URL вашего приложения на Render (например, https://2u-studio-kb.onrender.com)

4. Настройки ресурсов:
   - Выберите соответствующий план (Free, Starter или Standard)
   - Рекомендуется выбрать план с хотя бы 512MB RAM

5. Дополнительные настройки (опционально):
   - Auto-Deploy: Включите для автоматического деплоя при пуше в репозиторий
   - Health Check Path: `/api/health` (если создадите такой эндпоинт)

## Проверка после деплоя

1. После успешного деплоя проверьте корректность работы приложения:
   - Открывается ли главная страница
   - Работает ли авторизация (если есть)
   - Отображаются ли статьи и разделы
   - Можно ли создать новую статью

2. Если статьи не отображаются:
   - Проверьте логи на Render
   - Убедитесь, что MongoDB доступна и содержит данные
   - Проверьте, что `NEXT_PUBLIC_API_URL` указан корректно
   - Проверьте консоль браузера на наличие ошибок

## Заполнение базы данных

Для инициализации базы тестовыми данными можно:

1. Запустить скрипт `seed-db.js` через терминал Render:
   ```
   node scripts/seed-db.js
   ```

2. Или добавить в Build Command команду для запуска скрипта:
   ```
   npm install && node scripts/seed-db.js && npm run build
   ```

## Возможные проблемы и их решение

1. **Ошибка подключения к MongoDB**:
   - Проверьте правильность MONGODB_URI
   - Убедитесь, что IP вашего сервиса на Render добавлен в список разрешенных IP в MongoDB Atlas

2. **Ошибка сборки проекта**:
   - Проверьте логи сборки на Render
   - Убедитесь, что все зависимости корректно установлены

3. **Статьи не отображаются**:
   - Проверьте, что API запросы идут на правильный URL (NEXT_PUBLIC_API_URL)
   - Используйте больше логирования для отслеживания проблемы
   - Проверьте, что база данных содержит статьи и разделы

4. **Медленная работа приложения**:
   - Рассмотрите возможность обновления плана на Render для получения большего количества ресурсов
   - Оптимизируйте запросы к базе данных 