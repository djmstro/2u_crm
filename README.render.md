# Инструкции по деплою 2U Studio Knowledge Base на Render

## Настройка веб-сервиса

1. **Создайте новый веб-сервис** на Render:
   - Подключите GitHub репозиторий с проектом
   - Выберите ветку для деплоя (main)

2. **Основные настройки**:
   - **Name**: `2u-studio-kb`
   - **Environment**: Node
   - **Region**: Europe (Frankfurt) или ближайший к вам регион
   - **Branch**: main

3. **Команды для сборки и запуска**:
   - **Build Command**: `npm install && npm run pre-deploy && npm run build`
   - **Start Command**: `npm run start`

4. **Переменные окружения**:
   ```
   MONGODB_URI=mongodb+srv://djmstro:6PGxFCOhfvVor0Bw@cluster2u.kfj1nai.mongodb.net/?retryWrites=true&w=majority&appName=Cluster2u
   MONGODB_DB=2u_studio_kb
   NEXT_PUBLIC_API_URL=https://2u-studio-kb.onrender.com
   ```
   Замените URL в `NEXT_PUBLIC_API_URL` на фактический URL вашего приложения.

5. **План**:
   - Рекомендуется выбрать план Starter ($7/месяц) или выше для лучшей производительности.
   - Для тестирования можно использовать бесплатный план.

## После деплоя

1. **Проверьте подключение к базе данных**:
   - Откройте `/api/health` для проверки соединения с MongoDB.
   - Просмотрите логи на наличие ошибок.

2. **Диагностика проблем**:
   - Используйте `/api/debug` для проверки согласованности данных между статьями и разделами.
   - Используйте `/api/reset-cache` для сброса кэша соединения с MongoDB.

3. **Обновление настроек**:
   - Если приложение не отображает статьи, убедитесь, что `NEXT_PUBLIC_API_URL` указывает на правильный URL вашего сервиса.

## Запуск заполнения базы данных

Если вам нужно повторно заполнить базу данных тестовыми данными, используйте:

```
npm run seed
```

или напрямую:

```
node scripts/seed-db.js
```

## Проверка типов данных

Если возникают проблемы с сопоставлением статей и разделов, запустите:

```
node scripts/fix-section-types.js
```

Это исправит несоответствия типов между полями `section` в статьях и `priority` в разделах.

## Техническая поддержка

При возникновении проблем с деплоем, обратитесь к руководству по адресу:
`/render-deploy-guide.md` 